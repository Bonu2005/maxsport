// schema.prisma ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è MaxSport (Prisma + PostgreSQL)

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/**
 * Enum'—ã
 */
enum Role {
  USER
  TEACHER
  ADMIN
}

enum HomeworkStatus {
  PENDING
  CHECKED
  REJECTED
}

enum LessonStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum TestStatus {
  DRAFT // —á–µ—Ä–Ω–æ–≤–∏–∫
  ACTIVE // –∞–∫—Ç–∏–≤–µ–Ω
  FINISHED // –∑–∞–≤–µ—Ä—à—ë–Ω
}

enum Status {
  ACTIVE
  INACTIVE
  PENDING
  COMPLETED
}

enum MyCourseStatus {
  ACTIVE // –∫—É—Ä—Å —Å–µ–π—á–∞—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç
  COMPLETED // –∫—É—Ä—Å –∑–∞–≤–µ—Ä—à—ë–Ω
  DROPPED // –∫—É—Ä—Å –∑–∞–±—Ä–æ—à–µ–Ω
  INACTIVE
}

/**
 * –ú–æ–¥–µ–ª–∏
 */

model Users {
  id           String  @id @default(uuid())
  name         String
  email        String  @unique
  phoneNumber  String  @unique
  password     String
  role         Role    @default(USER)
  individualId String?
  img          String?
  experience   Int?
  status       Status  @default(PENDING)
  description  String?

  // Relations
  myCourses           MyCourse[] // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏/–∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å
  orders              Order[]
  reviews             Review[]
  payments            Payment[] // –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  homeworkSubmissions HomeworkSubmission[]

  testResults    UserTestResult[]
  coursesTaught  Course[]         @relation("TrainerCourses") // üëà —Å–≤—è–∑—å —Å –∫—É—Ä—Å–∞–º–∏, –≥–¥–µ —Ç—Ä–µ–Ω–µ—Ä
  diplomasTaught Diplom[]         @relation("TeacherDiploms") // üëà –¥–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ
  // timestampshhh

  createdAt          DateTime             @default(now())
  Course             Course[]
  Diplom             Diplom[]
  Email_verification Email_verification[]
  Sessions           Sessions[]
  resetPasswords     Reset_Password[]
}

model Reset_Password {
  id          String   @id @default(uuid())
  userId      String
  email       String   @unique
  phone       String
  secret      String
  otpVerified Boolean  @default(false)
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  user        Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Email_verification {
  id          String   @id @default(uuid())
  userId      String
  user        Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  email       String?  @unique
  phoneNumber String?  @unique
  secret      String
  otpVerified Boolean  @default(false)
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Sessions {
  id          String    @id @default(uuid())
  ip          String
  location    String?
  info        String
  date        DateTime  @default(now())
  endDate     DateTime?
  userId      String
  user        Users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  deviceType  String
  deviceGroup String
  browser     String
  createdAt   DateTime  @default(now())
}

model Course {
  id          String    @id @default(uuid())
  name        String
  price       Float
  text        String?
  date        DateTime?
  description String?
  image       String[]
  level       Int
  status      Status    @default(ACTIVE)

  // Trainer (user) ‚Äî —Ç—Ä–µ–Ω–µ—Ä –∫—É—Ä—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  trainerId             String?
  trainer               Users?     @relation("TrainerCourses", fields: [trainerId], references: [id])
  Course_duration       String
  Number_of_lessons     String
  Training_format       String     @default("OFFLINE")
  Course_Benefits_Sheet String
  // Relations
  modules               Modul[]
  lessons               Lesson[] // –µ—Å–ª–∏ —É —Ç–µ–±—è —É—Ä–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω—ã —Å –∫—É—Ä—Å–æ–º
  tests                 Test[]
  myCourses             MyCourse[]
  orders                Order[]
  payments              Payment[] // –ø—Ä—è–º—ã–µ –ø–ª–∞—Ç–µ–∂–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫—É—Ä—Å–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  diplomas              Diplom[]

  createdAt DateTime @default(now())
  User      Users?   @relation(fields: [userId], references: [id])
  userId    String?
}

model Modul {
  id        String   @id @default(uuid())
  name      String
  desc      String?
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id])
  title     String
  lessons   Lesson[]
  createdAt DateTime @default(now())
}

model Lesson {
  id        String         @id @default(uuid())
  name      String
  video     String?
  img       String[]
  desc      String?
  duration  Int?
  title     String // —Ç–µ–º–∞ —É—Ä–æ–∫–∞
  // —Å–≤—è–∑—å —Å –º–æ–¥—É–ª–µ–º (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è)
  modulId   String
  modul     Modul          @relation(fields: [modulId], references: [id])
  homeworks HomeworkTask[]
  createdAt DateTime       @default(now())
  Course    Course?        @relation(fields: [courseId], references: [id])
  courseId  String?
  startsAt  DateTime?
  status    LessonStatus   @default(DRAFT)
}

model HomeworkTask {
  id       String @id @default(uuid())
  lessonId String
  lesson   Lesson @relation(fields: [lessonId], references: [id])

  title       String
  description String?
  files       String[]

  deadline  DateTime?
  createdAt DateTime  @default(now())

  submissions HomeworkSubmission[]
}

model HomeworkSubmission {
  id String @id @default(uuid())

  homeworkId String
  homework   HomeworkTask @relation(fields: [homeworkId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])

  text  String?
  files String[]

  status    HomeworkStatus @default(PENDING)
  createdAt DateTime       @default(now())
}

model Review {
  id     String @id @default(uuid())
  userId String
  user   Users  @relation(fields: [userId], references: [id])

  message   String
  rating    Int?
  img       String[]
  createdAt DateTime @default(now())
}

model Order {
  id       String @id @default(uuid())
  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])

  status    Status   @default(PENDING)
  createdAt DateTime @default(now())

  payments Payment[]
}

model Payment {
  id       String @id @default(uuid())
  amount   Float
  status   Status @default(PENDING)
  currency String @default("UZS")

  clickTransId    String? // click_trans_id
  merchantTransId String?   @unique// merchant_trans_id
  errorCode       Int?
  errorNote       String?

  orderId String
  order   Order  @relation(fields: [orderId], references: [id])

  userId   String?
  user     Users?  @relation(fields: [userId], references: [id])
  courseId String?
  course   Course? @relation(fields: [courseId], references: [id])

  createdAt DateTime @default(now())
  
}

model Test {
  id   String @id @default(uuid())
  name String

  // –∫ –∫–∞–∫–æ–º—É –∫—É—Ä—Å—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è
  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
  duration Int?

  // –¥–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ —Ç–µ—Å—Ç–∞
  startDate DateTime?
  quantity Int?
  // —Å—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∞
  status TestStatus @default(DRAFT)

  // —Å–≤—è–∑–∏
  questions   Question[]
  userResults UserTestResult[]

  createdAt DateTime @default(now())
}

model Question {
  id             String   @id @default(uuid())
  questionNumber Int
  question       String
  testId         String
  test           Test     @relation(fields: [testId], references: [id])
  img            String[]
  answers        Answer[]
}

model Answer {
  id         String   @id @default(uuid())
  text       String
  isRight    Boolean  @default(false)
  questionId String
  question   Question @relation(fields: [questionId], references: [id])
}

model UserTestResult {
  id     String   @id @default(uuid())
  date   DateTime @default(now())
  score  Float?
  status Status   @default(COMPLETED)

  testId String
  test   Test   @relation(fields: [testId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])
}

model Diplom {
  id               String   @id @default(uuid())
  codeDiplom       String     @unique
  createdAt        DateTime @default(now())

  issuedAt         DateTime? // –¥–∞—Ç–∞ –≤—ã–¥–∞—á–∏ –¥–∏–ø–ª–æ–º–∞
  courseFinishedAt DateTime? // –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫—É—Ä—Å–∞

  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  teacherId String?
  teacher   Users? @relation("TeacherDiploms", fields: [teacherId], references: [id])

  userId String
  user   Users @relation(fields: [userId], references: [id])

  img String[]
}


model MyCourse {
  id String @id @default(uuid())

  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])

  status    MyCourseStatus @default(ACTIVE)
  createdAt DateTime       @default(now())
}

model Branch {
  id      String @id @default(uuid())
  city    String
  phone   String
  email   String
  address String
  mapLink String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Photo {
  id        String   @id @default(uuid())
  imageUrl  String
  createdAt DateTime @default(now())
}

model SocialNetwork {
  id        String   @id @default(uuid())
  name      String   // Instagram, Telegram, LinkedIn –∏ —Ç.–¥.
  url       String
  createdAt DateTime @default(now())
}