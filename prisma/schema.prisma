// schema.prisma ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è MaxSport (Prisma + PostgreSQL)

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/**
 * Enum'—ã
 */
enum Role {
  USER
  TEACHER
  ADMIN
}

enum Status {
  ACTIVE
  INACTIVE
  PENDING
  COMPLETED
}


enum MyCourseStatus {
  ACTIVE       // –∫—É—Ä—Å —Å–µ–π—á–∞—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç
  COMPLETED    // –∫—É—Ä—Å –∑–∞–≤–µ—Ä—à—ë–Ω
  DROPPED      // –∫—É—Ä—Å –∑–∞–±—Ä–æ—à–µ–Ω
  INACTIVE
}

/**
 * –ú–æ–¥–µ–ª–∏
 */

model Users {
  id           String     @id @default(uuid())
  name         String
  email        String     @unique
  phoneNumber  String     @unique
  password     String
  role         Role       @default(USER)
  individualId String?
  img          String?
  experience   Int?
  status       Status     @default(PENDING)
  // Relations
  myCourses    MyCourse[] // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏/–∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å
  orders       Order[]
  reviews      Review[]
  payments     Payment[] // –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  homeworks    HomeWork[]

  testResults        UserTestResult[]
  coursesTaught      Course[]             @relation("TrainerCourses") // üëà —Å–≤—è–∑—å —Å –∫—É—Ä—Å–∞–º–∏, –≥–¥–µ —Ç—Ä–µ–Ω–µ—Ä
  diplomasTaught     Diplom[]             @relation("TeacherDiploms") // üëà –¥–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ
  // timestamps
  createdAt          DateTime             @default(now())
  Course             Course[]
  Diplom             Diplom[]
  Email_verification Email_verification[]
  Sessions           Sessions[]
  resetPasswords     Reset_Password[]
}

model Reset_Password {
  id          String   @id @default(uuid())
  userId      String
  email       String   @unique
  phone       String
  secret      String
  otpVerified Boolean  @default(false)
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  user        Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Email_verification {
  id          String   @id @default(uuid())
  userId      String
  user        Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  email       String?  @unique
  phoneNumber String?  @unique
  secret      String
  otpVerified Boolean  @default(false)
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Sessions {
  id          String    @id @default(uuid())
  ip          String
  location    String?
  info        String
  date        DateTime  @default(now())
  endDate     DateTime?
  userId      String
  user        Users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  deviceType  String
  deviceGroup String
  browser     String
  createdAt   DateTime  @default(now())
}

model Course {
  id          String    @id @default(uuid())
  name        String
  price       Float
  text        String?
  date        DateTime?
  description String?
  image       String[]
  level       Int
  status      Status    @default(ACTIVE)

  // Trainer (user) ‚Äî —Ç—Ä–µ–Ω–µ—Ä –∫—É—Ä—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  trainerId             String?
  trainer               Users?     @relation("TrainerCourses", fields: [trainerId], references: [id])
  Course_duration       String
  Number_of_lessons     String
  Training_format       String     @default("OFFLINE")
  Course_Benefits_Sheet String
  // Relations
  modules               Modul[]
  lessons               Lesson[] // –µ—Å–ª–∏ —É —Ç–µ–±—è —É—Ä–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω—ã —Å –∫—É—Ä—Å–æ–º
  tests                 Test[]
  myCourses             MyCourse[]
  orders                Order[]
  payments              Payment[] // –ø—Ä—è–º—ã–µ –ø–ª–∞—Ç–µ–∂–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫—É—Ä—Å–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  diplomas              Diplom[]

  createdAt DateTime @default(now())
  User      Users?   @relation(fields: [userId], references: [id])
  userId    String?
}

model Modul {
  id        String   @id @default(uuid())
  name      String
  desc      String?
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id])
  title     String
  lessons   Lesson[]
  createdAt DateTime @default(now())
}

model Lesson {
  id       String   @id @default(uuid())
  name     String
  video    String?
  img      String[]
  desc     String?
  duration Int?

  // —Å–≤—è–∑—å —Å –º–æ–¥—É–ª–µ–º (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è)
  modulId String
  modul   Modul  @relation(fields: [modulId], references: [id])

  homeworks HomeWork[]
  createdAt DateTime   @default(now())
  Course    Course?    @relation(fields: [courseId], references: [id])
  courseId  String?
}

model HomeWork {
  id     String @id @default(uuid())
  userId String
  user   Users  @relation(fields: [userId], references: [id])

  text      String?
  img       String[]
  video     String[]
  createdAt DateTime @default(now())
  status    Status   @default(PENDING)

  lessonId String
  lesson   Lesson @relation(fields: [lessonId], references: [id])
}

model Review {
  id     String @id @default(uuid())
  userId String
  user   Users  @relation(fields: [userId], references: [id])

  message   String
  rating    Int?
  img       String[]
  createdAt DateTime @default(now())
}

model Order {
  id       String @id @default(uuid())
  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])

  status    Status   @default(PENDING)
  createdAt DateTime @default(now())

  payments Payment[]
}

model Payment {
  id       String @id @default(uuid())
  amount   Float
  status   Status @default(PENDING)
  currency String @default("UZS")

  // Payment –ø—Ä–∏–≤—è–∑–∞–Ω –∫ order ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Å–≤—è–∑—å
  orderId String
  order   Order  @relation(fields: [orderId], references: [id])

  createdAt DateTime @default(now())
  User      Users?   @relation(fields: [userId], references: [id])
  userId    String?
  Course    Course?  @relation(fields: [courseId], references: [id])
  courseId  String?
}

model Test {
  id       String @id @default(uuid())
  name     String
  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  questions   Question[]
  userResults UserTestResult[]
  createdAt   DateTime         @default(now())
}

model Question {
  id             String   @id @default(uuid())
  questionNumber Int
  question       String
  testId         String
  test           Test     @relation(fields: [testId], references: [id])
  img            String[]
  answers        Answer[]
}

model Answer {
  id         String   @id @default(uuid())
  text       String
  isRight    Boolean  @default(false)
  questionId String
  question   Question @relation(fields: [questionId], references: [id])
}

model UserTestResult {
  id     String   @id @default(uuid())
  date   DateTime @default(now())
  score  Float?
  status Status   @default(COMPLETED)

  testId String
  test   Test   @relation(fields: [testId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])
}

model Diplom {
  id         String   @id @default(uuid())
  codeDiplom String
  createdAt  DateTime @default(now())

  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  teacherId String?
  teacher   Users?  @relation("TeacherDiploms", fields: [teacherId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])

  img String[]
}

model MyCourse {
  id String @id @default(uuid())

  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  userId String
  user   Users  @relation(fields: [userId], references: [id])

  status    MyCourseStatus   @default(ACTIVE)
  createdAt DateTime @default(now())
}

model Branche {
  id    String  @id @default(uuid())
  phone String?
  email String?
  sex   String?
  time  String?
}
